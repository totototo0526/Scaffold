# Svelteによる画面定義自動生成ツール「Scaffold」フロントエンド開発ガイド

## プロジェクト概要

このプロジェクトは、Web画面の定義情報を入力すると、バックエンド（n8nとPostgreSQL）と連携して、画面のメタデータや開発用のひin形コードを自動生成するツール「Scaffold」のフロントエンドです。

あなたのタスクは、既存のコンポーネントを再利用しつつ、仕様に基づいてユーザーが操作するための機能を追加・実装することです。

## 技術スタック

-   **フレームワーク:** Svelte (SvelteKit)
-   **言語:** TypeScript
-   **スタイリング:** CSS (コンポーネント内)

## 既存の資産（作成済みコンポーネント）

-   `src/lib/DefinitionForm.svelte`: 画面定義の本体（ビューや項目のリスト）を入力するための、主要なフォームコンポーネントです。再利用してください。このコンポーネントは、入力が完了すると`submit`イベント経由で画面定義データを出力します。
-   `src/lib/Header.svelte`: アプリケーションのヘッダーです。
-   `src/lib/ResponseDisplay.svelte`: n8nからのAPI応答（成功・エラー）を表示するためのコンポーネントです。

## 作成・改修する画面 (2ページ)

1.  **メインページ (`/`) - （改修）**: 既存の画面定義ページに、DB接続機能を追加します。
2.  **管理者ページ (`/admin/connections`) - （新規作成）**: 接続先のデータベース情報を管理するための、新しいページを作成します。

## 必要な機能一覧

### 1. メインページ (`/`) の改修

-   **[UI] 接続情報入力フォームの追加**:
    -   既存の`<DefinitionForm />`コンポーネントの上に、以下の部品を新しく配置します。
        -   接続先DBを選択するためのコンボボックス。
        -   選択したDBに接続するためのパスワード入力欄。
-   **[GET] 接続先リストの動的取得**:
    -   ページ表示時、APIエンドポイント (`/webhook/get-targets`) を呼び出し、コンボボックスの選択肢を動的に生成します。
    -   ページの再表示時にもリストが更新されるよう、キャッシュ対策を施してください。（例: `?timestamp=${Date.now()}`）
-   **[POST] データ送信ロジックの統合**:
    -   「実行」ボタンが押されたら、`<DefinitionForm />`から受け取った画面定義データと、新しく追加したフォームから取得した`target_id`、`password`を合体させ、一つのJSONとしてメインのAPIエンドポイント (`/webhook/main-workflow`) にPOSTします。
-   **[UI] 実行結果の表示**:
    -   `<ResponseDisplay />`コンポーネントを使い、APIからの応答を表示します。

### 2. 管理者ページ (`/admin/connections`) の新規作成

-   **[GET] 接続先リストの表示**:
    -   `/webhook/get-targets` を呼び出し、取得した接続先情報をテーブル形式で表示します。
    -   各行に「削除」ボタンを設置します。
-   **[UI] 新規接続先登録フォーム**:
    -   新規接続先を登録するためのフォームを設置します。
-   **[POST] 登録・削除ロジック**:
    -   「登録」ボタンで新規登録API (`/webhook/register-target`) を呼び出します。
    -   「削除」ボタンで削除API (`/webhook/delete-target`) を呼び出します。

## 連携するAPIエンドポイント仕様

-   **[GET] `/webhook/get-targets`**: 接続先リスト取得
-   **[POST] `/webhook/main-workflow`**: 画面定義の生成・実行
-   **[POST] `/webhook/register-target`**: 新規接続先の登録
-   **[POST] `/webhook/delete-target`**: 既存接続先の削除

## 開発者への指示

-   上記の仕様に基づき、既存のSvelteコンポーネントを活かしながら、必要なUIの追加と機能の実装を行ってください。
-   コンポーネントの分割やスタイリングは、既存の設計思想を踏襲し、可読性とメンテナンス性を考慮して適切に行ってください。
-   API連携部分は、`fetch`を使用して非同期に実装してください。
-   エラーハンドリングを適切に行い、ユーザーにフィードバックを提供してください。
