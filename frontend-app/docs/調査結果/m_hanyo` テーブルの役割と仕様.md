# `m_hanyo` テーブルの役割と仕様（最終版）

### 概要 💡

`m_hanyo`テーブルは、各画面の**UI部品（検索フォーム、一覧リスト、ドロップダウンリストなど）の具体的なレイアウト、種類、データ連携を定義する**、データ駆動UIの心臓部です。

`mst_kbn`という区分を使い分けることで、「ページのコントローラー」「検索フォームの定義」「一覧リストの定義」「ドロップダウンの選択肢」といった複数の役割をこの一つのテーブルで実現しています。

---

### UI生成の仕組み

画面生成は、以下の流れで行われます。

1.  **ページの特定**: `m_content`の`url`（例: `msyohin`）で、表示するページが決定します。

2.  **定義グループの特定**:
    * `m_hanyo`の中から`mst_kbn`が`'CB'`（コントローラー）で、かつ`han_name`がページ名（`msyohin`）と一致するレコードを探します。
    * 見つかったレコードの`koumoku1`の値（例: `smsyohin`）を**「グループID」**として取得します。

3.  **UI部品の構築**:
    * `koumoku1`がその「グループID」（`smsyohin`）と一致するレコードを、`m_hanyo`から全て探し出します。
    * `mst_kbn`の値（`C2`や`C3`）に従って、検索フォームや一覧リストを画面上に組み立てます。
    * もし`C2`の定義でUI部品の種類(`koumoku4`)が`select`だった場合、さらに追加のデータ検索が行われます（後述）。

---

### `mst_kbn` の役割

`mst_kbn`は、レコードがUIのどの部分を定義しているかを示す「役割区分」です。

| `mst_kbn` | 役割 | 説明 |
| :--- | :--- | :--- |
| **`CB`** | **コントローラー** | ページ名とUI定義の「グループID」を紐づけます。 |
| **`C2`** | **入力フォーム定義** | 検索条件などの入力欄のラベル、種類、順序を定義します。 |
| **`C3`** | **一覧リスト定義** | 検索結果などを表示するテーブルの列ヘッダーやデータ連携を定義します。 |
| **`05`, `06`...** | **選択肢マスタ** | `C2`で定義されたドロップダウン（`select`）に表示する選択肢のリストを定義します。 |

---

### 選択肢（ドロップダウン）の生成

ドロップダウンリストは、`C2`（入力フォーム定義）と選択肢マスタ（`05`, `06`など）の連携によって作られます。

**ステップ1: `C2`で`select`を定義**
「種類」フィールドは以下の`C2`レコードで定義されています。

| mst_kbn | han_cd | han_name | koumo...1<br>(Group ID) | koumo...4<br>(UI Type) | koumo...6<br>(Option Key) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `C2` | ssmshin-02 | 種類 | `smsyohin` | `select` | **`05`** |

`koumoku4`が`select`なので、これはドロップダウンリストになります。そして`koumoku6`に入っている**`05`**が、選択肢のデータを探すためのキーとなります。

**ステップ2: 選択肢マスタからデータを取得**
アプリケーションは`koumoku6`のキーを使い、`mst_kbn`が`'05'`のレコードを全て検索します。

| mst_kbn | han_cd | han_name |
| :--- | :--- | :--- |
| `05` | 1 | SL |
| `05` | 2 | GL |
| `05` | 3 | 基板 |
| ... | ... | ... |

**ステップ3: ドロップダウンを構築**
取得したデータを元に、HTMLの`<select>`要素が組み立てられます。
`han_cd`が`<option>`の`value`値に、`han_name`が表示されるテキストになります。

```html
<select>
  <option value="1">SL</option>
  <option value="2">GL</option>
  <option value="3">基板</option>
  ...
</select>